name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  validate:
    name: Validate (lint + security + smoke)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install --ignore-scripts

      - name: Run repository validation
        run: npm run validate

      - name: Ensure no Anthropic secret-like values are committed
        run: |
          if rg -n "sk-ant-[A-Za-z0-9_-]{10,}" --glob '!node_modules/**' --glob '!.git/**'; then
            echo "Potential Anthropic secret detected in tracked files."
            exit 1
          fi
          echo "No Anthropic secret-like values found in repository files."
